
&НаКлиенте
Процедура Команда1(Команда)
	ЗаполнитьДеревоФич("C:\Users\Alehin Sasha\Desktop\п1");
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДеревоФич(КаталогФич)
	ПодготовитьФичи();
	
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("КаталогПоиска", КаталогФич + "\");
	
	НачатьПоискФайлов(Новый ОписаниеОповещения("ЗаполнитьДеревоФичЗавершение", ЭтотОбъект, ДополнительныеПараметры), КаталогФич, "*.feature", Истина);
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДеревоФичЗавершение(НайденныеФайлы, ДополнительныеПараметры) Экспорт
	Если ЗначениеЗаполнено(НайденныеФайлы) Тогда
		Для Каждого НайденныйФайл Из НайденныеФайлы Цикл
			Фича = СоздатьФичу(Параметры.Фичи, НайденныйФайл);
			ОпределитьРодительскиеКаталогиФичи(Фича, НайденныйФайл, ДополнительныеПараметры);
			
			Параметры.Фичи.Добавить(Фича);
		КонецЦикла;
	КонецЕсли;	
КонецПроцедуры

&НаКлиенте
Процедура ПодготовитьФичи()
	Параметры.Фичи = Новый Массив;
КонецПроцедуры

&НаКлиенте
Процедура СоздатьФичу(Фичи, НайденныйФайл)
	Фичи.Вставить("Имя", НайденныйФайл.Имя);
	Фичи.Вставить("ИмяБезРасширения", НайденныйФайл.ИмяБезРасширения);
	Фичи.Вставить("ПолноеИмя", НайденныйФайл.ПолноеИмя);
	Фичи.Вставить("Путь", НайденныйФайл.Путь);
	Фичи.Вставить("Расширение", НайденныйФайл.Расширение);
	Фичи.Вставить("Родитель", Неопределено);
КонецПроцедуры

&НаКлиенте
Процедура ОпределитьРодительскиеКаталогиФичи(Фича, НайденныйФайл, ДополнительныеПараметры)
	РодительскиеКаталоги = ПолучитьРодительскиеКаталоги(НайденныйФайл, ДополнительныеПараметры);
	
	СоздатьРодительскиеКаталоги(Фича, РодительскиеКаталоги);
КонецПроцедуры

&НаКлиенте
Процедура СоздатьРодительскиеКаталоги(Фича, РодительскиеКаталоги)
	ТекущийРодитель = ;
	
	
	Для Каждого РодительскийКаталог Из РодительскиеКаталоги Цикл
		ОписаниеРодителя = Новый Структура;
		
		ОписаниеРодителя.Вставить("Имя", РодительскийКаталог);
		ОписаниеРодителя.Вставить("Родитель", Неопределено);
	
		
	
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Функция ПолучитьРодительскиеКаталоги(НайденныйФайл, ДополнительныеПараметры)
	СтрокаРодительскихКаталогов = СтрЗаменить(НайденныйФайл.Путь, ДополнительныеПараметры.КаталогПоиска, "");

	Разделитель = "\";
	
	РодительскиеКаталоги = Новый Массив;
	
	Пока Не ПустаяСтрока(СтрокаРодительскихКаталогов) Цикл
		ПозицияРазделителя = СтрНайти(СтрокаРодительскихКаталогов, Разделитель);
		Если ПозицияРазделителя = 0 Тогда
			СтрокаРодительскихКаталогов = "";
		Иначе
			Родитель = Лев(СтрокаРодительскихКаталогов, ПозицияРазделителя - 1);
			
			РодительскиеКаталоги.Вставить(0, Родитель);
			
			СтрокаРодительскихКаталогов = Сред(СтрокаРодительскихКаталогов, ПозицияРазделителя + 1);
		КонецЕсли;
	КонецЦикла;
	
	Возврат РодительскиеКаталоги;
КонецФункции
